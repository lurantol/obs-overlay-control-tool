<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Overlay Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="header-row">
    <h1>Overlay Control</h1>

    <div class="service-links" aria-label="Служебные ссылки">
      <div class="service-title">Служебные ссылки (Browser Source)</div>

      <div class="service-item">
        <label>Current</label>
        <div class="service-input-row">
          <input id="service-current-url" type="text" readonly />
          <button class="small-btn" id="copy-current-url">Копировать</button>
        </div>
      </div>

      <div class="service-item">
        <label>Next</label>
        <div class="service-input-row">
          <input id="service-next-url" type="text" readonly />
          <button class="small-btn" id="copy-next-url">Копировать</button>
        </div>
      </div>
    </div>
  </div>

  <div class="tabs">
    <button class="tab-btn active" data-tab="live">Эфир</button>
    <button class="tab-btn" data-tab="setup">Настройка конкурсов</button>
    <button class="tab-btn" data-tab="admin">Админ</button>
    <button class="tab-btn" data-tab="overlay">Browser Overlay</button>
    <button class="tab-btn" data-tab="operator">Operator Mode</button>
  </div>

  <div id="tab-live" class="tab-content active">
    <div class="subtabs">
      <button class="live-subtab-btn active" data-subtab="finals">Финалы</button>
      <button class="live-subtab-btn" data-subtab="rounds">Отборы</button>
      <button class="live-subtab-btn" data-subtab="special">Special</button>
      <button class="live-subtab-btn" data-subtab="next">NEXT</button>
    </div>

    <div id="live-subtab-finals" class="live-subtab-content active">
      <h2>Эфир - Финалы</h2>

      <div class="panel">
        <h3>В ЭФИРЕ</h3>

        <div class="row">
          <label>Финал:</label>
          <select id="finals-contest-select"></select>
        </div>

        <div class="columns">
<div class="col">
            <h4>Лидер</h4>
            <select id="finals-first" size="10"></select>
          </div>
<div class="col">
            <h4>Фолловер</h4>
            <select id="finals-second" size="10"></select>
          </div>
        </div>

        <div class="row">
          <label class="checkbox-inline">
            <input type="checkbox" id="finals-no-pair">
            Без пары
          </label>
        </div>

        <div class="row">
          <div id="finals-preview" class="preview"></div>
        </div>

        <div class="row">
          <button id="finals-apply">Применить в эфир</button>
          <button id="onair-reset">Сбросить эфир</button>
        </div>

        <div id="finals-status" class="status"></div>
      </div>
    </div>

    <div id="live-subtab-rounds" class="live-subtab-content">
      <h2>Эфир - Отборы</h2>

      <div class="panel">
        <h3>В ЭФИРЕ</h3>

        <div class="row">
          <label>Отбор:</label>
          <select id="rounds-contest-select"></select>
        </div>

        <div class="row">
          <label>HEAT:</label>
          <div id="round-buttons" class="button-row"></div>
          <button class="small-btn" id="rounds-clear-heat" title="Убрать HEAT">Без HEAT</button>
        </div>

        <div class="row">
          <div id="rounds-preview" class="preview"></div>
        </div>

        <div class="row">
          <button id="rounds-apply">Применить в эфир</button>
          <button id="onair-reset-2">Сбросить эфир</button>
        </div>

        <div id="rounds-status" class="status"></div>
      </div>
    </div>

    <div id="live-subtab-special" class="live-subtab-content">
      <h2>Эфир - Special</h2>

      <div class="panel">
        <h3>В ЭФИРЕ</h3>

        <div class="row">
          <label>Special:</label>
          <select id="special-select"></select>
        </div>

        <div class="row">
  <label>Участник/команда:</label>
  <select id="special-item-select"></select>
</div>

<div class="row">
  <label class="checkbox-inline">
    <input type="checkbox" id="special-no-pair">
    Без пары
  </label>
</div>

<div class="row">
  <div id="special-preview" class="preview"></div>
</div>

        <div class="row">
          <button id="special-apply">Применить в эфир</button>
          <button id="onair-reset-3">Сбросить эфир</button>
        </div>

        <div id="special-status" class="status"></div>
      </div>
    </div>

    <div id="live-subtab-next" class="live-subtab-content">
      <h2>NEXT</h2>

      <div class="panel">
        <div class="row">
          <label>Следующая номинация:</label>
          <select id="next-contest-select"></select>
        </div>

        <div class="row" id="next-heat-row">
          <label>HEAT (только для отборов):</label>
          <div id="next-round-buttons" class="button-row"></div>
          <button class="small-btn" id="next-clear-heat" title="Убрать HEAT">Без HEAT</button>
        </div>

        <div class="row">
          <div id="next-preview" class="preview"></div>
        </div>

        <div class="row">
          <button id="next-apply">Применить NEXT</button>
          <button id="next-reset">Сбросить NEXT</button>
        </div>

        <div id="next-status" class="status"></div>
      </div>
    </div>
  </div>

  <div id="tab-setup" class="tab-content">
    <h2>Настройка конкурсов</h2>

    <div class="row">
      <label for="setup-contest-select">Конкурс:</label>
      <select id="setup-contest-select"></select>
    </div>

    <div class="columns">
      <div class="col">
        <h3>Лиды (по умолчанию: нечётные)</h3>
        <div id="setup-leads"></div>
      </div>
      <div class="col">
        <h3>Фолловеры (по умолчанию: чётные)</h3>
        <div id="setup-follows"></div>
      </div>
    </div>

    <div class="row">
      <button id="save-contest-btn">Сохранить состав конкурса</button>
    </div>

    <div id="status-setup" class="status"></div>
  </div>

  <div id="tab-admin" class="tab-content">
    <h2>Админ</h2>

    <div class="subtabs">
      <button class="admin-subtab-btn active" data-subtab="settings">Настройки</button>
      <button class="admin-subtab-btn" data-subtab="import">Импорт</button>
      <button class="admin-subtab-btn" data-subtab="special">Special</button>
    </div>

    <div id="admin-subtab-settings" class="admin-subtab-content active">
      <div class="panel">
        <h3>Номинации</h3>

        <div class="row">
          <label>Название:</label>
          <input type="text" id="new-contest-name" placeholder="Strictly Open, JJ Novice Finals..." />
        </div>

        <div class="row">
          <label>Тип:</label>
          <select id="new-contest-type">
            <option value="rounds">Отборы</option>
            <option value="finals">Финалы</option>
          </select>
        </div>

        <div class="row">
          <button id="add-contest-btn">Добавить номинацию</button>
        </div>

        <div id="status-admin" class="status"></div>

        <h4>Список номинаций</h4>
        <ul id="contest-list"></ul>
      </div>

      <div class="panel">
        <h3>Кнопки HEAT для отборов</h3>
        <p class="hint">Список задаётся через запятую: <code>Heat 1, Heat 2, Heat 3</code></p>

        <div class="row">
          <label>Список:</label>
          <input type="text" id="round-buttons-input" placeholder="Heat 1, Heat 2, Heat 3" />
        </div>

        <div class="row">
          <button id="save-round-buttons">Сохранить кнопки</button>
        </div>

        <div id="round-buttons-status" class="status"></div>
      </div>
    </div>

    <div id="admin-subtab-import" class="admin-subtab-content">
      <div class="panel">
        <h3>Импорт участников (CSV / XLS / XLSX)</h3>
        <p class="hint">Шаг 1: загрузи файл -> увидишь заголовки -> выбери, какая колонка с номером и какая с именем.</p>

        <input type="file" id="import-file" accept=".csv,.xls,.xlsx">
        <button id="import-preview-btn">Загрузить и показать колонки</button>

        <div id="import-mapping" class="mapping hidden">
          <div class="row">
            <label>Колонка с номером:</label>
            <select id="import-number-col"></select>
          </div>
          <div class="row">
            <label>Колонка с именем (одна строка):</label>
            <select id="import-name-col"></select>
          </div>

          <div class="row">
            <label>Роли по номеру:</label>
            <div class="radio-row">
              <label class="radio-inline">
                <input type="radio" name="import-leader-parity" id="import-leader-odd" value="odd" checked>
                Лидер — нечётные
              </label>
              <label class="radio-inline">
                <input type="radio" name="import-leader-parity" id="import-leader-even" value="even">
                Лидер — чётные
              </label>
            </div>
          </div>

          <div class="row">
            <button id="import-confirm-btn">Импортировать</button>
          </div>
          <div class="row">
            <pre id="import-sample" class="sample"></pre>
          </div>
        </div>

        <div id="import-status" class="status"></div>
      </div>
    </div>

    <div id="admin-subtab-special" class="admin-subtab-content">
      <div class="panel">
        <h3>Special - типы и команды</h3>
        <p class="hint">Каждая строка - отдельный участник или команда. Можно вводить через запятую или с новой строки.</p>

        <div class="row">
          <label>Название Special:</label>
          <input type="text" id="special-name" placeholder="Team Match, All-Stars, Showcase..." />
        </div>

        <div class="row">
          <label>Участники / команды:</label>
          <textarea id="special-teams" rows="8" style="width:100%" placeholder="Ирина Пузанова - Павел Катунин\nПерчики\nИрина Поповиченко - Владимир Леонов"></textarea>
        </div>

        <div class="row">
          <button id="special-add-btn">Добавить</button>
          <button id="special-update-btn" disabled>Сохранить изменения</button>
          <button id="special-cancel-edit" disabled>Отмена</button>
        </div>

        <div id="special-admin-status" class="status"></div>

        <h4>Список Special</h4>
        <ul id="special-list"></ul>
      </div>
    </div>
  </div>

  <div id="tab-overlay" class="tab-content">
    <h2>Browser Overlay</h2>

    <div class="panel">
      <h3>Настройка внешнего вида (веб-страница для Browser Source)</h3>
      <p class="hint">Эти настройки применяются к /overlay.html (Current и Next). После сохранения OBS Browser Source обновит стиль автоматически.</p>

      <div class="columns">
        <div class="col">
          <h4>Шрифты</h4>
          <div class="row">
            <label>Title шрифт:</label>
            <select id="overlay-title-font"></select>
          </div>
          <div class="row">
            <label>Pair шрифт:</label>
            <select id="overlay-pair-font"></select>
          </div>

          <div class="row">
            <label>Добавить шрифт (ttf/otf/woff/woff2):</label>
            <input type="file" id="overlay-font-upload" accept=".ttf,.otf,.woff,.woff2" />
            <button id="overlay-font-upload-btn">Загрузить</button>
          </div>
          <p class="hint">После загрузки шрифт появится в списке. Имя берётся из названия файла.</p>
        </div>

        <div class="col">
          <h4>Предпросмотр</h4>
          <p class="hint">Мини-превью реального оверлея (как в OBS Browser Source). Показывает сохранённые настройки.</p>
          <div style="width: 100%; aspect-ratio: 16 / 9; background: rgba(0,0,0,0.15); border-radius: 10px; overflow: hidden;">
            <iframe id="overlay-preview" src="/overlay.html?mode=current&preview=1&hideEmpty=0" style="width:100%;height:100%;border:0;"></iframe>
          </div>
        </div>
      </div>

      <div class="columns">
        <div class="col">
          <h4>Title</h4>
          <div class="row">
            <label>Размер (px):</label>
            <input type="number" id="overlay-title-size" min="10" max="200" step="1" />
          </div>
          <div class="row">
            <label>Цвет:</label>
            <input type="color" id="overlay-title-color" />
          </div>
        </div>

        <div class="col">
          <h4>Pair</h4>
          <div class="row">
            <label>Размер (px):</label>
            <input type="number" id="overlay-pair-size" min="10" max="200" step="1" />
          </div>
          <div class="row">
            <label>Цвет:</label>
            <input type="color" id="overlay-pair-color" />
          </div>
        </div>
      </div>

      <div class="row">
        <button id="overlay-save">Сохранить настройки</button>
      </div>

      <div id="overlay-status" class="status"></div>
    </div>
  </div>

  <div id="tab-operator" class="tab-content">
    <div class="operator-shell">
      <div class="operator-topbar">
        <div class="operator-title">
          <div class="operator-title-main">Operator Mode</div>
          <div class="operator-title-sub">Touch-first экран для управления эфиром (iPad-friendly)</div>
        </div>

        <div class="operator-status">
          <span class="operator-pill" id="op-obs-pill">OBS: <span id="op-obs-state">—</span></span>
          <button class="operator-btn secondary" id="op-reconnect">Reconnect</button>
        </div>
      </div>

      <div class="operator-tabs">
        <button class="operator-tab-btn active" data-subtab="view">View</button>
        <button class="operator-tab-btn" data-subtab="settings">Settings</button>
      </div>

      <div id="operator-subtab-view" class="operator-subtab active">
        <div class="operator-grid">
          <div class="operator-card operator-preview-card">
            <div class="operator-card-header">
              <div class="operator-card-title">ON AIR</div>
              <div class="operator-card-meta">Program</div>
            </div>
            <div class="operator-preview" id="op-program-preview">
              <div class="operator-preview-placeholder">Program preview</div>
            </div>
            <div class="operator-card-footer">
              <div class="operator-kv">Scene: <span id="op-program-scene">—</span></div>
              <div class="operator-kv">Updated: <span id="op-program-updated">—</span></div>
            </div>
          </div>

          <div class="operator-card operator-preview-card">
            <div class="operator-card-header">
              <div class="operator-card-title">PREVIEW</div>
              <div class="operator-card-meta">Studio Mode</div>
            </div>
            <div class="operator-preview" id="op-preview-preview">
              <div class="operator-preview-placeholder">Preview</div>
            </div>
            <div class="operator-card-footer">
              <div class="operator-kv">Scene: <span id="op-preview-scene">—</span></div>
              <div class="operator-kv">Updated: <span id="op-preview-updated">—</span></div>
            </div>
          </div>

          <div class="operator-card operator-controls-card">
            <div class="operator-card-header">
              <div class="operator-card-title">Controls</div>
              <div class="operator-card-meta">Large buttons</div>
            </div>

            <div class="operator-controls-grid">
              <button class="operator-btn" id="op-prev">Prev</button>
              <button class="operator-btn" id="op-next">Next</button>
              <button class="operator-btn primary" id="op-choose">Choose dancers</button>
              <button class="operator-btn" id="op-clear">Clear</button>
              <button class="operator-btn" id="op-hide">Hide</button>
              <button class="operator-btn" id="op-apply">Apply to OBS</button>
            </div>

            <div class="operator-hint">На Этапе 1 кнопки не привязаны к логике. Это каркас UI.</div>
          </div>

          <div class="operator-card operator-history-card">
            <div class="operator-card-header">
              <div class="operator-card-title">History</div>
              <div class="operator-card-meta">Undo / Redo</div>
            </div>
            <div class="operator-history" id="op-history">
              <div class="operator-history-item current">(current) Jack &amp; Jill All Star Finals • Alex — Maria</div>
              <div class="operator-history-item">Jack &amp; Jill All Star Finals • Alex (solo)</div>
              <div class="operator-history-item">Advanced Finals • Mike — Kate</div>
              <div class="operator-history-item">—</div>
            </div>
          </div>
        </div>

        <div class="operator-modal-backdrop" id="op-modal-backdrop" aria-hidden="true">
          <div class="operator-modal" role="dialog" aria-modal="true">
            <div class="operator-modal-header">
              <div class="operator-modal-title">Choose dancers</div>
              <button class="operator-btn secondary" id="op-modal-close">Close</button>
            </div>

            <div class="operator-modal-body">
              <div class="operator-form-row">
                <label class="operator-label">Division (Finals only)</label>
                <select class="operator-select" id="op-division-select">
                  <option>Jack &amp; Jill All Star Finals</option>
                  <option>Jack &amp; Jill Intermediate Finals</option>
                  <option>Advanced Finals</option>
                </select>
              </div>

              <div class="operator-form-row">
                <label class="operator-checkbox">
                  <input type="checkbox" id="op-without-pair" />
                  Without partner
                </label>
              </div>

              <div class="operator-dual">
                <div class="operator-dual-col">
                  <div class="operator-dual-title">LEADER</div>
                  <input class="operator-input" placeholder="Search leader" />
                  <div class="operator-list">
                    <button class="operator-list-item selected" type="button">Alex Smith</button>
                    <button class="operator-list-item" type="button">John Doe</button>
                    <button class="operator-list-item" type="button">Mike Brown</button>
                  </div>
                </div>

                <div class="operator-dual-col">
                  <div class="operator-dual-title">FOLLOWER</div>
                  <input class="operator-input" placeholder="Search follower" />
                  <div class="operator-list">
                    <button class="operator-list-item selected" type="button">Maria Ivanova</button>
                    <button class="operator-list-item" type="button">Anna Petrova</button>
                    <button class="operator-list-item" type="button">Kate Johnson</button>
                  </div>
                </div>
              </div>

              <div class="operator-selected">Selected: <span id="op-selected">Alex Smith — Maria Ivanova</span></div>
            </div>

            <div class="operator-modal-footer">
              <button class="operator-btn" id="op-set-leader">SET LEADER NOW</button>
              <button class="operator-btn" id="op-set-follower">SET FOLLOWER NOW</button>
              <button class="operator-btn primary" id="op-set-both">SET BOTH</button>
            </div>
          </div>
        </div>
      </div>

      <div id="operator-subtab-settings" class="operator-subtab">
        <div class="operator-settings-grid">
          <div class="operator-card">
            <div class="operator-card-header">
              <div class="operator-card-title">OBS Connection</div>
              <div class="operator-card-meta">WebSocket</div>
            </div>

            <div class="operator-form">
              <div class="operator-form-row">
                <label class="operator-label">Host</label>
                <input class="operator-input" id="op-obs-host" placeholder="127.0.0.1" />
              </div>
              <div class="operator-form-row">
                <label class="operator-label">Port</label>
                <input class="operator-input" id="op-obs-port" placeholder="4455" />
              </div>
              <div class="operator-form-row">
                <label class="operator-label">Password</label>
                <input class="operator-input" id="op-obs-password" type="password" placeholder="••••••••" />
              </div>

              <div class="operator-actions">
                <button class="operator-btn" id="op-test">Test connection</button>
                <button class="operator-btn primary" id="op-save">Save</button>
              </div>

              <div class="operator-hint">На Этапе 1 это только UI. Подключение к OBS добавим в следующем этапе.</div>
            </div>
          </div>

          <div class="operator-card">
            <div class="operator-card-header">
              <div class="operator-card-title">Screenshots</div>
              <div class="operator-card-meta">Preview refresh</div>
            </div>

            <div class="operator-form">
              <div class="operator-form-row">
                <label class="operator-label">Update interval (sec)</label>
                <input class="operator-input" id="op-shot-interval" type="number" min="0" step="0.5" value="1" />
              </div>
              <div class="operator-form-row">
                <label class="operator-label">Quality (10..100)</label>
                <input class="operator-input" id="op-shot-quality" type="number" min="10" max="100" step="1" value="70" />
              </div>
              <div class="operator-form-row">
                <label class="operator-label">Resolution</label>
                <select class="operator-select" id="op-shot-resolution">
                  <option value="1280x720">1280×720</option>
                  <option value="1920x1080">1920×1080</option>
                  <option value="custom">Custom…</option>
                </select>
              </div>

              <div class="operator-form-row">
                <label class="operator-checkbox">
                  <input type="checkbox" id="op-preview-only-studio" checked />
                  Preview only if Studio Mode
                </label>
              </div>
              <div class="operator-form-row">
                <label class="operator-checkbox">
                  <input type="checkbox" id="op-auto-refresh" checked />
                  Auto-refresh screenshots
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
  <script src="operator-ui.js"></script>
</body>
</html>
