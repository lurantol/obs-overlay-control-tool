# OBS Overlay Control Tool

Инструмент для управления текстовыми и браузерными оверлеями OBS на танцевальных фестивалях  
(West Coast Swing и аналогичные форматы).

---

## Назначение

Приложение предназначено для оператора трансляции и решает задачу  
быстрого, безопасного и структурированного вывода информации в OBS:

- текущая номинация в эфире;
- текущая пара (для финалов);
- отборы / prelims / semis с Heat’ами;
- анонс следующего дивизиона (NEXT);
- показательные выступления (Special / Show / Formation);
- работа с реальными списками участников из CSV / Excel;
- стабильный вывод текста без проблем OBS Text Source.

Приложение работает **локально**, без интернета.

---

## Как это работает (общая схема)

1. Приложение запускается на ноутбуке оператора.
2. Управление осуществляется через браузер (Mac / iPad).
3. Приложение хранит текущее состояние эфира.
4. OBS получает данные:
   - либо через текстовые файлы;
   - либо через Browser Source (рекомендуется).

Архитектура не использует WebSocket, плагины OBS или внешние сервисы,  
что снижает риск сбоев во время эфира.

---

## Источники в OBS

### Text Source (классический вариант)

Используются файлы:

- `out/current_title.txt` — что сейчас в эфире
- `out/current_pair.txt` — текущая пара / участник
- `out/next_title.txt` — следующий дивизион (NEXT)

OBS читает эти файлы через `Text (from file)`.

---

### Browser Source вместо Text Source (рекомендуется)

OBS иногда некорректно обновляет Text Source (пропадание символов).  
Для решения этой проблемы в приложении реализован **Browser Overlay**.

Приложение отдаёт готовую HTML-страницу:

- **Current (title + pair)**  
  `http://127.0.0.1:3000/overlay.html?mode=current`

- **Next (только заголовок NEXT)**  
  `http://127.0.0.1:3000/overlay.html?mode=next`

Эти ссылки также отображаются в интерфейсе приложения и доступны для копирования.

#### Параметры Browser Overlay
- `interval=300` — частота обновления (мс)
- `hideEmpty=1` — скрывать пустые строки
- `titleSize=48px`
- `pairSize=40px`

---

## Вкладка «Эфир»

Основная рабочая панель оператора.

### Финалы
- выбор номинации;
- выбор **Лидера** и **Фоллоуера**;
- кнопка «Применить в эфир».

Результат:
- `current_title` — название финала;
- `current_pair` — «Лидер — Фоллоуер».

Heat’ы отсутствуют.

---

### Отборы
Используется для prelims / semis:
- выбор номинации;
- выбор **HEAT** (Heat 1–4);
- кнопка «Без HEAT» для сброса;
- кнопка «Применить в эфир».

Результат:
- `current_title` — «Номинация • Heat X»;
- `current_pair` очищается.

---

### NEXT
Режим анонса следующего дивизиона:
- выбор номинации;
- Heat — только для отборов;
- кнопка «Применить NEXT».

Результат:
- `next_title` — «NEXT: …».

---

### Special
Используется для показательных и шоу-выступлений:
- ProShow;
- Team Show;
- Formation;
- Guest Performance и т.п.

Логика:
1. выбирается тип Special;
2. появляется второй выпадающий список с участниками / командами;
3. выбирается конкретная строка;
4. кнопка «Применить в эфир».

Результат:
- `current_title` — тип выступления;
- `current_pair` — выбранный участник / команда.

---

## Вкладка «Админ»

Раздел подготовки и настройки данных.

### Номинации
- добавление финалов и отборов;
- указание типа (финалы / отборы);
- ограничение списка участников для конкретной номинации;
- настройка кнопок HEAT.

---

### Special
Каталог типов показательных выступлений:
- добавление / редактирование типов (ProShow, Team Show и т.д.);
- для каждого типа задаётся список строк  
  (каждая строка — участник / пара / команда);
- используется во вкладке «Эфир → Special».

---

### Импорт
Импорт участников из CSV / XLS / XLSX:

1. Загрузка файла.
2. Просмотр заголовков.
3. Выбор колонки с номером и колонки с именем.
4. Импорт данных.

Роли назначаются автоматически:
- нечётный номер → lead;
- чётный номер → follow.

Роль не ограничивает выбор в финалах.

---

## Вкладка «Browser Overlay»

Раздел настройки внешнего вида веб-оверлея.

Возможности:
- отдельный шрифт для **Title** и **Pair**;
- выбор шрифтов через выпадающие списки;
- загрузка пользовательских шрифтов (`ttf / otf / woff / woff2`);
- настройка:
  - размера шрифта;
  - цвета текста;
- **live preview** — мини-превью реального Browser Overlay прямо в интерфейсе.

Настройки сохраняются и автоматически применяются в OBS.

---

## Запуск

### Требования
- macOS
- Node.js 18+
- OBS Studio

### Установка
```bash
npm install
```

### Запуск
```bash
npm start
```

При запуске в консоль выводится:
- localhost / 127.0.0.1;
- LAN IP текущей машины;
- готовые ссылки на Browser Overlay (Current / Next).

### Открытие интерфейса
- Mac: `http://localhost:3000`
- iPad / другое устройство: `http://IP_Мака:3000`

---

## Почему такая архитектура

- отказ от OBS WebSocket и плагинов;
- локальная работа без интернета;
- минимальное количество точек отказа;
- ориентация на реальные фестивальные сценарии;
- устойчивость при высокой нагрузке и стрессе в эфире.

---

## Целевая аудитория

- операторы OBS;
- медиакоманды танцевальных фестивалей;
- организаторы соревнований;
- ситуации, где ошибка в эфире недопустима.
